"0","#eDNA Index Calculation"
"0","### 1) Calculate each taxon's proortion per replicate within a run"
"0","post_occ_counts_rep_unique %>% "
"0","  pivot_longer(., names_to=""replicate"", cols=`nextseq_1996_4_80_60_1_1`:`seb_2019_4_93.3_60_1_3`,values_to=""counts"") %>% "
"0","  mutate(., site= str_sub(replicate,1,-5))  %>% #name change to pull out ""site"""
"0","  mutate(., site= str_replace(site, ""nextseq_"","""")) %>% #name change to pull out ""site"""
"0","    mutate(., site= str_replace(site, ""seb_"","""")) %>% #name change to pull out ""site"""
"0","  group_by(sum.taxonomy,replicate,site) %>% "
"0","dplyr::summarise(meanreads = mean(counts), sumreads = sum(counts)) ->  post_occ_counts_replicate_long #mean and sums should be identical now"
"2","`summarise()` regrouping output by 'sum.taxonomy', 'replicate' (override with `.groups` argument)
"
"0","post_occ_counts_replicate_long %>% "
"0","ungroup() %>% "
"0","group_by(replicate) %>% "
"0","dplyr::summarise(rep_Tot = sum(sumreads)) -> rep_sums #calculate unique replicate sums"
"2","`summarise()` ungrouping output (override with `.groups` argument)
"
"0","post_occ_counts_replicate_long %>% "
"0","  left_join(rep_sums) %>% "
"0","  dplyr::ungroup() %>% "
"0","  filter(., rep_Tot>0) %>% "
"0","  dplyr::group_by (sum.taxonomy) %>%"
"0","  mutate(., Row.sums = meanreads / rep_Tot)-> post_occ_counts_replicate_long"
"2","Joining, by = ""replicate""
"
"0","### 2) average these proportions across replicates -whether or not those replicates are on the same run"
"0","post_occ_counts_replicate_long %>% "
"0","  group_by(site,sum.taxonomy) %>% "
"0","  dplyr::summarise(., mean_Row.sums = mean(Row.sums)) -> post_occ_counts_site_long"
"2","`summarise()` regrouping output by 'site' (override with `.groups` argument)
"
"0","post_occ_counts_site_long %>% "
"0","dplyr::ungroup() %>% "
"0","  dplyr::group_by (sum.taxonomy) %>%"
"0","  dplyr::summarise(Colmax = max(mean_Row.sums))  -> post_Rowsums"
"2","`summarise()` ungrouping output (override with `.groups` argument)
"
"0","### 3) divivde by max proportion (site average) observed in the whole data set"
"0","post_occ_counts_site_long %>% "
"0","  left_join(post_Rowsums) %>% "
"0","    dplyr::ungroup() %>% "
"0","  dplyr::group_by (sum.taxonomy) %>%"
"0","  mutate(Normalized.reads = mean_Row.sums / Colmax)-> post_occ_eIDX_site_int"
"2","Joining, by = ""sum.taxonomy""
"
"0","post_occ_eIDX_site_int %>% "
"0","  group_by(sum.taxonomy) %>% "
"0","  summarise(max(Normalized.reads)) %>% "
"0","  filter(., `max(Normalized.reads)` <1) #confirm that the max is 1 for all species"
"1","[1]"
"1"," max(Normalized.reads)"
"1","
"
"1","<0 rows> (or 0-length row.names)
"
"0","post_occ_eIDX_site_int %>% "
"0","  dplyr::select(sum.taxonomy, site, Normalized.reads) %>% "
"0","  pivot_wider(names_from=site, values_from=Normalized.reads, values_fill=0) -> post_occ_eIDX_site"
"0","# Anchovy Check"
"0","post_occ_counts_site_long %>% "
"0","  left_join(post_Rowsums) %>% "
"0","    dplyr::ungroup() %>% "
"0","  dplyr::group_by (sum.taxonomy) %>%"
"0","  mutate(Normalized.reads = mean_Row.sums / Colmax) %>% "
"0","  filter(., sum.taxonomy==""Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulis mordax"") -> chovy_check"
"2","Joining, by = ""sum.taxonomy""
"
"0","chovy_check %>% "
"0","  arrange(desc(Normalized.reads))"
"1","[38;5;246m# A tibble: 86 x 5[39m
[38;5;246m# Groups:   sum.taxonomy [1][39m
   site           sum.taxonomy                                                                 mean_Row.sums Colmax Normalized.reads
   [3m[38;5;246m<chr>[39m[23m          [3m[38;5;246m<chr>[39m[23m                                                                                [3m[38;5;246m<dbl>[39m[23m  [3m[38;5;246m<dbl>[39m[23m            [3m[38;5;246m<dbl>[39m[23m
[38;5;250m 1[39m 2003_4_93.3_30 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.433  0.433            1    
[38;5;250m 2[39m 2018_4_86.7_50 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.426  0.433            0.983
[38;5;250m 3[39m 2019_4_93.3_60 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.411  0.433            0.949
[38;5;250m 4[39m 1999_4_93.3_30 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.408  0.433            0.942
[38;5;250m 5[39m 2017_4_86.7_50 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.403  0.433            0.930
[38;5;250m 6[39m 2018_4_93.3_30 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.370  0.433            0.854
[38;5;250m 7[39m 2017_4_80_60   Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.369  0.433            0.852
[38;5;250m 8[39m 2005_4_86.7_50 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.348  0.433            0.804
[38;5;250m 9[39m 2019_4_93.3_30 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.343  0.433            0.793
[38;5;250m10[39m 2006_4_86.7_50 Eukaryota;Chordata;Actinopteri;Clupeiformes;Engraulidae;Engraulis;Engraulisâ€¦         0.331  0.433            0.764
[38;5;246m# â€¦ with 76 more rows[39m"
"1","
"
"0","post_occ_eIDX_site %>% "
"0","    filter(., sum.taxonomy==""Eukaryota;Chordata;Actinopteri;Stomiiformes;Phosichthyidae;Vinciguerria;"")"
"1","[38;5;246m# A tibble: 1 x 87[39m
[38;5;246m# Groups:   sum.taxonomy [1][39m
  sum.taxonomy `1996_4_80_60` `1996_4_86.7_50` `1996_4_93.3_30` `1996_4_93.3_60` `1998_4_80_60` `1998_4_93.3_30` `1998_4_93.3_60`
  [3m[38;5;246m<chr>[39m[23m                 [3m[38;5;246m<dbl>[39m[23m            [3m[38;5;246m<dbl>[39m[23m            [3m[38;5;246m<dbl>[39m[23m            [3m[38;5;246m<dbl>[39m[23m          [3m[38;5;246m<dbl>[39m[23m            [3m[38;5;246m<dbl>[39m[23m            [3m[38;5;246m<dbl>[39m[23m
[38;5;250m1[39m Eukaryota;Câ€¦              0                0                0          0.001[4m7[24m[4m6[24m              0                0           0.068[4m4[24m
[38;5;246m# â€¦ with 79 more variables: `1999_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `1999_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `1999_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `1999_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2000_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2000_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2000_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2000_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2001_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2001_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2001_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2001_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2002_3_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2002_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2002_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2002_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2003_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2003_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2003_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2003_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2004_3_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2004_3_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2004_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2004_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2005_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2005_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2005_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2005_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2006_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2006_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2006_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2006_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2007_3_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2007_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2007_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2007_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2008_3_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2008_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2008_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2009_3_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2009_3_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2009_3_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2009_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2010_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2010_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2010_5_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2011_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2011_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2011_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2011_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2012_3_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2012_3_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2012_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2012_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2013_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2013_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2013_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2013_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2014_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2014_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2014_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2015_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2015_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2015_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2015_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2016_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2016_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2016_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2017_3_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2017_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2017_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2018_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2018_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2018_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m,[39m
[38;5;246m#   `2018_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2019_4_80_60` [3m[38;5;246m<dbl>[38;5;246m[23m, `2019_4_86.7_50` [3m[38;5;246m<dbl>[38;5;246m[23m, `2019_4_93.3_30` [3m[38;5;246m<dbl>[38;5;246m[23m, `2019_4_93.3_60` [3m[38;5;246m<dbl>[38;5;246m[23m[39m"
"1","
"
